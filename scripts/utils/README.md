# Utility Scripts

This directory contains utility scripts that are used by the main scripts in the parent directory.

## Available Scripts

### `path_resolver.sh`

This script handles path resolution and validation.

#### Path Resolver Capabilities

- Creates a configuration file if it doesn't exist
- Validates paths to important directories
- Resolves the kubeconfig path
- Provides functions for path validation

#### Path Resolver Implementation

```bash
# Run directly
./path_resolver.sh

# Or source in another script
source ./path_resolver.sh
```

### `k8s_validator.sh`

This script validates Kubernetes configuration and resources.

#### K8s Validator Capabilities

- Checks if kubectl is installed
- Checks if the Kubernetes cluster is accessible
- Checks if the necessary resources are available

#### K8s Validator Implementation

```bash
# Run directly
./k8s_validator.sh

# Or source in another script
source ./k8s_validator.sh
```

### `error_handler.sh`

This script handles errors and provides recovery procedures.

#### Error Handler Capabilities

- Provides functions for error handling
- Logs errors to a deployment log
- Attempts to recover from common errors
- Displays troubleshooting information

#### Error Handler Implementation

```bash
# Source in another script
source ./error_handler.sh

# Then use the functions
handle_error 1 "Failed to access Kubernetes" recover_kubernetes_access
display_troubleshooting 1 "kubernetes"
```

## Functions Reference

### path_resolver.sh

- `validate_path(path, description, create_if_missing)`: Validates that a path exists
- `resolve_kubeconfig()`: Finds the correct kubeconfig path
- `update_config(key, value)`: Updates a value in the config file
- `validate_kubeconfig()`: Validates the kubeconfig path
- `validate_all_paths()`: Validates all important paths

### k8s_validator.sh

- `check_kubectl()`: Checks if kubectl is installed
- `check_cluster_access()`: Checks if the Kubernetes cluster is accessible
- `validate_kubernetes()`: Validates the Kubernetes configuration

### error_handler.sh

- `print_message(color, message)`: Prints a colored message
- `log_message(level, message)`: Logs a message to the deployment log
- `handle_error(error_code, error_message, recovery_function)`: Handles an error
- `display_troubleshooting(error_code, component)`: Displays troubleshooting information
- `recover_kubernetes_access()`: Attempts to recover Kubernetes access
- `recover_opentofu_state()`: Attempts to recover OpenTofu state
- `recover_wazuh_deployment()`: Attempts to recover Wazuh deployment

## Configuration

The scripts use a configuration file located at `${REPO_ROOT}/config.env`.
This file is created automatically by the `path_resolver.sh` script if it doesn't exist.

Example configuration:

```bash
# Wazuh and OpenTofu Local K3S Configuration
# This file is automatically generated and can be modified

# Kubernetes Configuration
KUBE_CONFIG_PATH="/home/user/.kube/config"
KUBE_CONTEXT="default"
WAZUH_NAMESPACE="wazuh"

# Repository Paths
WAZUH_KUBERNETES_REPO="/path/to/wazuh-kubernetes"
WAZUH_KUBERNETES_VERSION="v4.5.0"  # Pin to specific version
OPENTOFU_DIR="/path/to/terraform"
SCRIPTS_DIR="/path/to/scripts"

# Deployment Configuration
STORAGE_CLASS="wazuh-local-storage"
ENVIRONMENT="local"
```
